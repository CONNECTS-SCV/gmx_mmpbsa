# gmx_MMPBSA 분석 유형 가이드

이 문서는 gmx_MMPBSA workflow의 6가지 분석 유형과 각각의 용도를 설명합니다.

---

## 1. 기본 결합 자유 에너지 (1_binding_free_energy.yaml)

### 용도
단백질-리간드 결합 강도 계산 (가장 기본적이고 자주 사용되는 분석)

### 계산 결과
- **ΔG_binding** (결합 자유 에너지)
- "이 약물이 단백질에 얼마나 강하게 결합하나요?"에 대한 답변

### 특징
- 엔트로피 + 에너지 분해 옵션 포함 (enabled: true/false로 제어)
- 논문에서 가장 많이 보고하는 값
- 올인원 분석 파일 (모든 기능 포함 가능)

### 사용 시나리오
- 신약 후보 물질의 결합 친화도 평가
- 여러 리간드의 결합력 비교
- 실험 데이터(IC50, Kd)와 비교

---

## 2. 단백질 안정성 (2_stability.yaml)

### 용도
단백질 구조의 안정성 평가 (리간드 없이 단백질만 분석)

### 계산 결과
- **ΔG_folding** (접힘 자유 에너지)
- "돌연변이가 단백질을 불안정하게 만드나요?"에 대한 답변

### 특징
- 리간드 그룹은 입력으로 받지만 계산에서 무시됨
- Complex만 계산 (Receptor, Ligand 분리 안 함)
- 엔트로피 계산 **지원 안 함** (delta 값이 없어서)

### 사용 시나리오
- 단백질 공학 (돌연변이 안정성 평가)
- 열 안정성(thermostability) 연구
- 접힘 자유 에너지 계산

---

## 3. 알라닌 스캐닝 (3_alanine_scanning.yaml)

### 용도
중요한 결합 잔기 찾기 (hot spot 식별)

### 계산 결과
- **ΔΔG = ΔG_mutant - ΔG_wildtype**
- "어떤 아미노산이 결합에 가장 중요한가요?"에 대한 답변

### 특징
- 한 번에 **1개 잔기만** 알라닌(또는 글리신)으로 돌연변이
- Chain ID 필수: `"A/50"` 형식
- 엔트로피 계산 **지원 안 함** (mutant delta 구조 처리 불가)

### 제약사항
- **gmx_MMPBSA 제약**: 1개씩만 처리 가능
- 여러 잔기 스캔 = 각 잔기마다 별도 실행 필요
- 예: A/50, A/51, A/52 → 3번 실행

### 결과 해석
- **ΔΔG > 0 (양수)**: 결합력 감소 → **중요한 잔기!**
- **ΔΔG < 0 (음수)**: 결합력 증가
- **ΔΔG ≈ 0**: 영향 없음

### 사용 시나리오
- 약물 타겟 검증
- 중요 잔기 식별 (hot spot mapping)
- 합리적 돌연변이 설계

---

## 4. QM/MMGBSA (4_qm_mmgbsa.yaml)

### 용도
양자역학으로 특정 영역을 정확하게 계산

### 계산 결과
- **ΔG_binding** (QM 레벨로 계산)
- 금속 배위, 공유 결합, 전하 이동 등 특수한 상호작용 포함

### 특징
- 리간드 + 활성부위 잔기만 QM으로 계산 (나머지는 MM)
- **매우 느림** (수 시간 ~ 수 일)
- QM 영역 최소화 필수 (5-10 잔기 이내 권장)
- GB만 지원 (PB 불가)

### QM 영역 선택 방법
1. **거리 기반 (권장)**: `qm_residues: "within 4"`
2. **명시적 지정**: `qm_residues: "A/40-41,44,47 B/241"`
3. **Amber mask (고급)**: `com_qmmask: "(:44,47&!@N,H) | :241"`

### 사용 시나리오
- 금속 이온 배위 결합 계산
- 공유 결합 형성 분석
- 전하 이동, 극성화 효과 연구
- MM이 정확하지 않은 특수한 경우

---

## 5. 엔트로피 보정 (5_entropy_correction.yaml)

### 용도
엔트로피 기여도를 포함한 정확한 자유 에너지 계산

### 계산 결과
- **ΔG = ΔH - TΔS**
- ΔH: 엔탈피 (MM/GBSA에서 계산)
- TΔS: 엔트로피 기여 (이 분석으로 추가)

### 특징
- 엔트로피 방법 비교 및 최적화 전용
- 1번 파일과 동일하지만 엔트로피 튜닝에 집중

### 엔트로피 방법 (CHARMM36m 호환)
| 방법 | 속도 | 정확도 | 프레임 수 | 적합한 경우 | CHARMM |
|------|------|--------|-----------|-------------|---------|
| **NMODE** | ⚡ | ⭐⭐⭐⭐⭐ | 10-50 | 작은 시스템 | ❌ AMBER only |
| **QH** | ⚡⚡⚡ | ⭐⭐⭐ | 100-1000 | 유연한 시스템 | ✅ |
| **IE** | ⚡⚡⚡⚡ | ⭐⭐⭐⭐ | 100+ | 일반적 사용 ★ | ✅ |
| **C2** | ⚡⚡⚡ | ⭐⭐⭐ | 100+ | IE 대안 | ✅ |

### 사용 시나리오
- 엔트로피 방법 비교 (IE vs QH vs C2)
- 최적 파라미터 찾기 (프레임 수, interval 등)
- 분자의 유연성 손실을 고려한 진짜 ΔG 계산

---

## 6. 에너지 분해 (6_decomposition.yaml)

### 용도
어떤 잔기가 얼마나 기여하는지 상세 분석

### 계산 결과
- **잔기별/쌍별 에너지 기여도**
- "Arg50이 -5 kcal/mol 기여, Asp30이 -3 kcal/mol"

### 분해 타입
1. **Per-residue** (권장)
   - 각 잔기의 기여도 계산
   - 빠름
   - 먼저 이것부터 시작

2. **Pairwise**
   - 잔기-잔기 상호작용 에너지
   - 매우 느림 (N² 계산)
   - 상세 분석시에만 사용

### 에너지 항목
- **VDWAALS**: 반데르발스 상호작용
- **EEL**: 정전기 상호작용
- **EGB/EPB**: 극성 용매화 에너지
- **ESURF**: 비극성 용매화 에너지
- **TOTAL**: 전체 기여도

### 결과 해석
- **음수 (-)**: 결합에 유리 → **중요 잔기!**
- **양수 (+)**: 결합에 불리
- **0에 가까움**: 영향 없음

### 사용 시나리오
- Hot spot 찾기 (TOTAL이 큰 음수인 잔기)
- 돌연변이 타겟 선정
- 약물 설계 (어떤 상호작용이 중요한지)
- 결과를 CSV로 내보내서 엑셀/파이썬으로 시각화

---

## 실제 연구 워크플로우 권장

### 단계별 접근

1. **초기 스크리닝** (빠르게)
   ```bash
   # 1번: 엔트로피 off, 분해 off
   ./run_mmpbsa_full.sh -c configs/1_binding_free_energy.yaml
   # enabled: false로 설정
   ```

2. **중요 잔기 찾기**
   ```bash
   # 6번: Per-residue decomposition
   ./run_mmpbsa_full.sh -c configs/6_decomposition.yaml
   # print_res: "within 6"
   ```

3. **Hot spot 검증**
   ```bash
   # 3번: 중요 잔기를 알라닌으로 변경
   # residues: "A/50" (6번에서 찾은 잔기)
   ./run_mmpbsa_full.sh -c configs/3_alanine_scanning.yaml
   ```

4. **정확한 최종 값**
   ```bash
   # 5번: 엔트로피 포함
   # method: ie (가장 빠르고 정확)
   ./run_mmpbsa_full.sh -c configs/5_entropy_correction.yaml
   ```

5. **특수 케이스** (필요시)
   ```bash
   # 4번: 금속/공유결합이 있으면
   ./run_mmpbsa_full.sh -c configs/4_qm_mmgbsa.yaml
   ```

6. **단백질 안정성** (필요시)
   ```bash
   # 2번: 돌연변이의 단백질 안정성 영향
   ./run_mmpbsa_full.sh -c configs/2_stability.yaml
   ```

---

## 분석별 계산 시간 (대략적)

| 분석 | 속도 | 프레임 100개 기준 |
|------|------|-------------------|
| 1번 (엔트로피 off) | ⚡⚡⚡⚡ | ~10분 |
| 1번 (엔트로피 on, IE) | ⚡⚡⚡ | ~30분 |
| 2번 (stability) | ⚡⚡⚡⚡ | ~5분 |
| 3번 (alanine scan, 1개) | ⚡⚡⚡ | ~20분 |
| 4번 (QM/MM) | ⚡ | 수 시간~수 일 |
| 5번 (IE) | ⚡⚡⚡ | ~30분 |
| 6번 (per-residue) | ⚡⚡⚡ | ~20분 |
| 6번 (pairwise) | ⚡ | 수 시간 |

---

## CHARMM36m 호환성 요약

| 분석 | CHARMM 호환 | 주의사항 |
|------|-------------|----------|
| 1번 | ✅ | NMODE 제외, IE/QH/C2 사용 |
| 2번 | ✅ | 엔트로피 지원 안 함 |
| 3번 | ✅ | 엔트로피 지원 안 함 |
| 4번 | ✅ | GB만 가능, PB 불가 |
| 5번 | ✅ | NMODE 제외, IE/QH/C2 사용 |
| 6번 | ✅ | GB/PB 가능, 3D-RISM 불가 |

---

## 참고사항

- **CHARMM36m 사용시**: NMODE는 항상 불가 (AMBER only)
- **MPI 병렬화**: 대부분의 계산에서 권장 (QM/MM은 제한적)
- **프레임 수**:
  - 일반 계산: 100-1000 프레임
  - QM/MM: 10-100 프레임 (매우 느림)
  - NMODE: 10-50 프레임 (불가능하지만 참고용)
- **결과 파일**: `FINAL_RESULTS_MMPBSA.dat`, `FINAL_DECOMP_MMPBSA.csv` 등

---

**작성일**: 2026-01-15
**gmx_MMPBSA 버전**: 1.6.4
**Force Field**: CHARMM36m
